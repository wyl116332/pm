KISSY.add("sf-footprint",["node","kg/xtemplate/4.4.0/","json","io"],function(t,e){function n(t){return(t+"").replace(/,/g,"")}function r(t){var e=parseFloat(t/100);return e?(e>=1e8?(e=parseInt(e)/1e8,e+="<s>\u4ebf</s>"):e>=1e4&&(e=parseInt(e)/1e4,e+="<s>\u4e07</s>"),e):t}function a(t){var e=6e4,n=60*e,r=24*n,a=7*r,i=30*r,s=(new Date).getTime(),o=s-t,u=null;return 0>o?!1:u=o/i>=1?parseInt(o/i)+"\u4e2a\u6708\u524d":o/a>=1?parseInt(o/a)+"\u5468\u524d":o/r>=1?parseInt(o/r)+"\u5929\u524d":o/n>=1?parseInt(o/n)+"\u5c0f\u65f6\u524d":o/e>=1?parseInt(o/e)+"\u5206\u949f\u524d":"\u521a\u521a"}function i(){this.init.apply(this,arguments)}var s=e("node"),o=s.all,u=e("kg/xtemplate/4.4.0/"),l=e("json"),c=e("io");return u.addCommand("formatPrice",function(t,e){var a=parseFloat(n(e.params[0]));return r(a)}),u.addCommand("formatTime",function(t,e){var n=e.params[0];return a(n)}),i.prototype={init:function(t){var e=this;e.$module=o(t),e.tpl=e.getTpl(),e.url=e.getUrl(),e.getData()},getTpl:function(){return'{{#if(count>0)}}<div class="footprint-wrapper"><div class="title"><label>\u6211\u7684\u8db3\u8ff9</label><span>\u6211\u6700\u8fd1\u770b\u8fc7\u7684</span><button type="button" id="J-NextPageBtn" title>\u6362\u4e0b\u4e00\u6ce2</button></div><div class="foot-list"><ul>{{#each(items)}}<li><a href="//sf.taobao.com/sf_item/{{this.itemId}}.htm" target="_blank"><div class="left"><img src="{{this.picUrl}}" alt="{{this.title}}"></div><div class="right"><p class="name">{{this.title}}</p><p class="price">\u5f53\u524d\u4ef7<span class="current-price">{{{formatPrice(this.currentPrice)}}}</span></p><p class="time">{{{formatTime(this.time)}}}</p></div></a></li>{{/each}}</ul></div></div>{{/if}}'},getUrl:function(t){var e=this;t||(t=".Data");var n=e.$module.one(t);if(!n.length)return{};var r=n.html();return l.parse(r)},getData:function(){var t,e,n=this;n.url.ioUrl?(t=n.url.ioUrl.connctUrl,e=n.url.ioUrl.count,this.url=t,this.count=e):(t=this.url,e=this.count),new c({type:"get",url:t+"count="+e,dataType:"jsonp",success:function(t){"1"===t.status&&t.success===!0&&n.render(t)}})},render:function(t){var e=this,n=e.tpl,r=new u(n).render({count:t.count,items:t.items}),a=o(".footprint-wrapper");a.length?(a.remove(),o(r).appendTo(e.$module)):o(r).appendTo(e.$module),t.more===!0&&e.bindNextPage(t)},bindNextPage:function(t){var e=this;if(t.count<=0)return!1;var n=t.count-1;e.endTime=t.items[n].time;var r=o("#J-NextPageBtn");r.on("click",function(){new c({type:"get",url:e.url+"count="+e.count+"&time="+e.endTime,dataType:"jsonp",success:function(t){"1"===t.status&&t.success===!0&&(t.more===!0?e.render(t):e.getData())}})})}},i});